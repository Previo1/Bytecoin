<!DOCTYPE html>
<html lang="gu">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>BYTE Coin ‚Äî Tap to Earn (Modern)</title>
<link rel="icon" href="coin.png">
<style>
:root{
  --bg:#071025; --card:#0f1724; --muted:#93a4bd; --accent:#ffb020;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:linear-gradient(180deg,#031026 0%,#071428 100%);color:#e6eef8;min-height:100vh;display:flex;flex-direction:column;align-items:stretch}
.app{max-width:820px;margin:0 auto;flex:1;display:flex;flex-direction:column}
header{padding:14px 16px;text-align:center;font-weight:700;font-size:18px;background:linear-gradient(90deg,rgba(255,255,255,0.02),transparent)}
main{flex:1;overflow:auto;padding:16px}
.card{background:var(--card);border-radius:14px;padding:14px;margin-bottom:14px;box-shadow:0 12px 30px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.02)}
.center{text-align:center}
.huge-coin{
  width:320px; height:320px; display:block; margin:18px auto; border-radius:50%;
  cursor:pointer; transition: transform .12s ease, box-shadow .12s ease;
  box-shadow: 0 8px 30px rgba(0,0,0,0.6), 0 0 0 0 rgba(255,176,32,0.0);
}
.huge-coin.pulse{ animation: pulse 1s infinite; box-shadow: 0 12px 40px rgba(255,176,32,0.12); }
@keyframes pulse { 0%{ transform:scale(1) } 50%{ transform:scale(1.02) } 100%{ transform:scale(1) } }

.balance{font-size:26px;font-weight:800;margin-top:8px}
.sub{color:var(--muted);font-size:13px;margin-top:6px}
.row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;margin-top:12px}
.btn{background:linear-gradient(180deg,var(--accent),#f59e0b);color:#061018;border:none;padding:12px 16px;border-radius:12px;font-weight:800;cursor:pointer}
.btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
.small{font-size:13px;padding:8px 10px}
.ref-box{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;word-break:break-all}
.menu{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(0deg, rgba(2,6,23,0.95), rgba(2,6,23,0.98));display:flex;gap:0;justify-content:space-around;padding:10px 6px;border-top:1px solid rgba(255,255,255,0.02)}
.menu button{flex:1;background:transparent;border:0;color:var(--muted);padding:6px 4px;font-weight:700;cursor:pointer;border-radius:8px;font-size:13px}
.menu button.active{color:var(--accent);box-shadow:0 6px 18px rgba(255,176,32,0.12)}
.kv{display:flex;justify-content:space-between;align-items:center;margin-top:8px}
.badge{padding:6px 8px;border-radius:8px;background:rgba(255,255,255,0.03)}
.leader{max-height:200px;overflow:auto;margin-top:8px}
.footer-note{font-size:12px;color:var(--muted);text-align:center;margin-top:8px}
.copy{cursor:pointer;color:var(--accent);font-weight:700}
</style>
</head>
<body>
<div class="app">
  <header>BYTE Coin ‚Äî Community (Phase 1)</header>
  <main id="main">
    <!-- HOME -->
    <section id="home" class="card center">
      <div style="display:flex;flex-direction:column;align-items:center;gap:8px">
        <div class="balance">Balance: <span id="balance">0</span> BYTE</div>
        <div class="sub">Energy: <span id="energy">0</span> | Streak: <span id="streak">0</span> days</div>
      </div>

      <img src="coin.png" id="coin" class="huge-coin pulse" alt="coin (tap)" title="Tap to mine BYTE">

      <div class="row">
        <button class="btn small" id="spinBtn">üé° Spin</button>
        <button class="btn small" id="boostBtn">‚ö° Boost</button>
        <button class="btn small" id="shareBtn">üîó Share</button>
      </div>

      <div class="card" style="margin-top:12px;text-align:left">
        <div class="kv"><div><strong>Referral & Channel</strong><div class="small">Share bot link ‚Äî earn extra</div></div>
          <div class="badge">L1 20% ‚Ä¢ L2 10% ‚Ä¢ L3 5%</div></div>
        <div style="margin-top:10px">
          <div class="ref-box" id="refBox"></div>
          <div style="margin-top:10px" class="row">
            <button class="btn small" id="copyRef">Copy Link</button>
            <button class="btn small ghost" id="tgRef">Share to Telegram</button>
            <button class="btn small ghost" id="waRef">Share to WhatsApp</button>
          </div>
        </div>
        <div style="margin-top:12px" class="row">
          <button class="btn small" id="joinChan">Join Channel & Claim +1000 BYTE</button>
        </div>
      </div>
    </section>

    <!-- REFERRAL -->
    <section id="ref" class="card" style="display:none">
      <h3>Your Referral</h3>
      <div class="ref-box" id="myRefBox"></div>
      <div style="margin-top:12px" class="kv"><div>Paste code (or open link):</div></div>
      <input id="applyInput" placeholder="Enter ref code" style="width:100%;padding:10px;border-radius:10px;background:transparent;border:1px solid rgba(255,255,255,0.03);margin-top:8px;color:inherit">
      <div class="row" style="margin-top:10px"><button class="btn small" id="applyBtn">Apply Referral</button></div>

      <div style="margin-top:14px">
        <h4>Your Referrals</h4>
        <div id="myRefs" class="leader small-muted">No referrals yet</div>
      </div>
      <div style="margin-top:14px">
        <h4>Local Leaderboard</h4>
        <ol id="leaderboard" class="leader"></ol>
      </div>
    </section>

    <!-- PROFILE -->
    <section id="profile" class="card" style="display:none">
      <h3>Profile</h3>
      <div class="kv"><div>Username</div><div id="uname">‚Äî</div></div>
      <div class="kv"><div>Balance</div><div id="uprofileBal">0</div></div>
      <div class="kv"><div>Referral count</div><div id="urefcount">0</div></div>
      <div style="margin-top:12px" class="row">
        <button class="btn small" id="connectWallet">Connect Telegram Wallet</button>
        <button class="btn small ghost" id="exportBtn">Export Data</button>
      </div>
      <div style="margin-top:12px" class="footer-note">Connect wallet opens official Telegram Wallet.</div>
    </section>

    <!-- WHITEPAPER -->
    <section id="white" class="card center" style="display:none">
      <h3>White Paper</h3>
      <p class="small-muted">Open on Telegram channel</p>
      <div style="margin-top:12px"><a class="btn small" href="https://t.me/bytecoinS22m/6" target="_blank">Open White Paper</a></div>
    </section>
  </main>

  <nav class="menu" role="navigation">
    <button id="nav-home" class="active" onclick="navTo('home')">üè†<div style="font-size:11px">Home</div></button>
    <button id="nav-tap" onclick="navTo('ref')">ü™ô<div style="font-size:11px">Referral</div></button>
    <button id="nav-ref" onclick="navTo('profile')">üë•<div style="font-size:11px">Profile</div></button>
    <button id="nav-prof" onclick="navTo('white')">üìÑ<div style="font-size:11px">White</div></button>
  </nav>
</div>

<script>
/* ---------------------------
   App State (localStorage)
   --------------------------- */
const APP_KEY = "byte_v3_state";
const LB_KEY = "byte_v3_leaderboard";

let state = JSON.parse(localStorage.getItem(APP_KEY)) || {
  username: "USER" + Math.floor(Math.random()*90000+10000),
  balance: 0,
  energy: 500,
  lastReset: null,
  streak: 0,
  lastLogin: null,
  refBy: null,
  referrals: [], // {code, date}
  spins: [],
  joinedChannel: false,
  boostUntil: null
};

function saveState(){ localStorage.setItem(APP_KEY, JSON.stringify(state)); }

/* ---------------------------
   Init daily reset + UI init
   --------------------------- */
function init(){
  // Reset energy daily
  const today = new Date().toDateString();
  if(state.lastReset !== today){
    state.energy = 500;
    state.lastReset = today;
  }
  // Streak calc
  if(state.lastLogin){
    const last = new Date(state.lastLogin).toDateString();
    const yesterday = new Date(Date.now() - 24*3600*1000).toDateString();
    if(last === yesterday) state.streak = (state.streak || 0) + 1;
    else if(last !== today) state.streak = 1;
  } else state.streak = 1;
  state.lastLogin = Date.now();
  saveState();
  renderAll();
  processUrlRef();
  registerLocalUser();
}

/* ---------------------------
   Helper: local user ledger
   --------------------------- */
function ensureUserRec(u){
  const key = APP_KEY + "_" + u;
  if(!localStorage.getItem(key)){
    localStorage.setItem(key, JSON.stringify({username:u, balance:0, refBy:null, referrals:[], lastSeen:Date.now()}));
  }
}
function addToUser(u, amt){
  if(!u || amt<=0) return;
  ensureUserRec(u);
  const key = APP_KEY + "_" + u;
  const rec = JSON.parse(localStorage.getItem(key));
  rec.balance = (rec.balance||0) + amt;
  rec.lastSeen = Date.now();
  localStorage.setItem(key, JSON.stringify(rec));
  updateLeaderboard(rec);
}

/* ---------------------------
   Leaderboard (local)
   --------------------------- */
function loadLB(){ return JSON.parse(localStorage.getItem(LB_KEY) || "[]"); }
function saveLB(lb){ localStorage.setItem(LB_KEY, JSON.stringify(lb)); }
function updateLeaderboard(rec){
  let lb = loadLB();
  lb = lb.filter(x => x.username !== rec.username);
  lb.push({username: rec.username, balance: rec.balance||0});
  lb.sort((a,b)=>b.balance - a.balance);
  lb = lb.slice(0,50);
  saveLB(lb);
}

/* ---------------------------
   Referral link & render
   --------------------------- */
function myBotLink(){ return `https://t.me/Bytescoin_robot?start=${encodeURIComponent(state.username)}`; }
function renderAll(){
  document.getElementById("balance").innerText = Math.floor(state.balance);
  document.getElementById("energy").innerText = state.energy;
  document.getElementById("streak").innerText = state.streak;
  document.getElementById("refBox").innerText = myBotLink();
  document.getElementById("myRefBox").innerText = myBotLink();
  document.getElementById("uname").innerText = state.username;
  document.getElementById("uprofileBal").innerText = Math.floor(state.balance);
  document.getElementById("urefcount").innerText = state.referrals.length || 0;
  // refs list
  const myRefsEl = document.getElementById("myRefs");
  if(state.referrals.length){
    myRefsEl.innerHTML = state.referrals.map(r=>`<div style="padding:6px 0">${r.code} ‚Ä¢ ${new Date(r.date).toLocaleDateString()}</div>`).join("");
  } else myRefsEl.innerHTML = "<div class='small-muted'>No referrals yet</div>";
  // leaderboard
  const lb = loadLB();
  const lbEl = document.getElementById("leaderboard");
  lbEl.innerHTML = lb.length ? lb.map((r,i)=>`<li style="padding:6px 0;display:flex;justify-content:space-between"><div><strong>#${i+1}</strong> ${r.username}</div><div>${r.balance} BYTE</div></li>`).join("") : "<li class='small-muted'>No entries yet</li>";
  saveState();
}

/* ---------------------------
   Tap action
   --------------------------- */
function tap(){
  if(state.energy <= 0){ alert("No energy left ‚Äî claim daily bonus to refill."); return; }
  // base reward = 1
  let mult = 1;
  if(state.boostUntil && Date.now() < state.boostUntil) mult = 2;
  if(state.streak >= 7) mult += 0.5; // small streak bonus
  const amt = Math.max(1, Math.round(1 * mult));
  state.balance += amt;
  state.energy -= 1;
  // achievements counter
  state.taps = (state.taps||0) + 1;
  // distribute referral passive rewards
  distributeReferralRewards(amt);
  saveState(); renderAll();
  registerLocalUser(); // update local ledger
}
function distributeReferralRewards(amt){
  if(!state.refBy) return;
  // L1 20%
  addToUser(state.refBy, Math.floor(amt * 0.20));
  // L2
  const r1 = getRefOf(state.refBy);
  if(r1) addToUser(r1, Math.floor(amt * 0.10));
  // L3
  const r2 = getRefOf(r1);
  if(r2) addToUser(r2, Math.floor(amt * 0.05));
}

/* read 'refBy' for another user from local ledger */
function getRefOf(username){
  const key = APP_KEY + "_" + username;
  if(!localStorage.getItem(key)) return null;
  try{ const rec = JSON.parse(localStorage.getItem(key)); return rec.refBy || null; }catch(e){return null}
}

/* ---------------------------
   Referral application (by code or URL)
   --------------------------- */
function applyReferral(code){
  if(!code) { alert("Enter referral code"); return; }
  if(code === state.username){ alert("Cannot use your own code"); return; }
  if(state.refBy){ alert("Referral already applied"); return; }
  // set ref relationship on referrer record
  ensureUserRec(code);
  const key = APP_KEY + "_" + code;
  const rec = JSON.parse(localStorage.getItem(key));
  rec.referrals = rec.referrals || [];
  rec.referrals.push(state.username);
  localStorage.setItem(key, JSON.stringify(rec));
  // set our refBy
  state.refBy = code;
  state.referrals.push({code, date: Date.now()});
  // immediate sign-up bonuses to referrer and their chain
  addToUser(code, 200); // L1 sign-up
  const r1 = getRefOf(code); if(r1) addToUser(r1, 100);
  const r2 = getRefOf(r1); if(r2) addToUser(r2, 50);
  saveState(); renderAll();
  alert("Referral applied ‚Äî referrer rewarded!");
}

/* ---------------------------
   Process URL referral param (ref or start)
   --------------------------- */
function processUrlRef(){
  const p = new URLSearchParams(window.location.search);
  const r = p.get("ref") || p.get("start");
  if(r && r !== state.username && !state.refBy){
    applyReferral(r);
  }
}

/* ---------------------------
   Share / Copy / Join Channel
   --------------------------- */
document.getElementById("copyRef").addEventListener("click", async ()=>{
  const txt = myBotLink();
  try{ await navigator.clipboard.writeText(txt); alert("Referral link copied!"); }
  catch(e){ alert("Copy failed ‚Äî please copy manually: " + txt); }
});
document.getElementById("tgRef").addEventListener("click", ()=>{
  const u = encodeURIComponent(myBotLink());
  window.open(`https://t.me/share/url?url=${u}`,"_blank");
});
document.getElementById("waRef").addEventListener("click", ()=>{
  const text = encodeURIComponent("Join BYTE Coin & earn: " + myBotLink());
  window.open(`https://api.whatsapp.com/send?text=${text}`,"_blank");
});
document.getElementById("joinChan").addEventListener("click", ()=>{
  if(state.joinedChannel){ alert("You've already claimed channel bonus."); return; }
  // open channel
  window.open("https://t.me/bytecoinS22m","_blank");
  // award 1000 BYTE (local)
  state.balance += 1000;
  state.joinedChannel = true;
  saveState(); renderAll();
  alert("üéâ Channel join reward: +1000 BYTE added!");
});

/* ---------------------------
   Spin (simple) & Boost
   --------------------------- */
document.getElementById("spinBtn").addEventListener("click", ()=>{
  const today = new Date().toDateString();
  const spinsToday = state.spins.filter(s=> new Date(s).toDateString() === today).length;
  if(spinsToday >= 1 && !confirm("Today's free spin used. Spin again?")) return;
  const outcomes = [{v:5,w:40},{v:20,w:30},{v:50,w:18},{v:200,w:8},{v:500,w:4}];
  let total = outcomes.reduce((s,o)=>s+o.w,0);
  let pick = Math.random()*total;
  let chosen = outcomes.find(o => (pick -= o.w) <= 0);
  if(!chosen) chosen = outcomes[0];
  state.balance += chosen.v;
  state.spins.push(Date.now());
  saveState(); renderAll();
  alert(`üéâ You won ${chosen.v} BYTE`);
});
document.getElementById("boostBtn").addEventListener("click", ()=>{
  if(confirm("Activate boost (2x) for 10 minutes?")){ state.boostUntil = Date.now() + 10*60*1000; saveState(); renderAll(); alert("Boost active for 10 minutes"); }
});
document.getElementById("shareBtn").addEventListener("click", ()=>{
  const url = myBotLink();
  const txt = `Join me on BYTE Coin ‚Äî Tap & Earn: ${url}`;
  if(navigator.share){ navigator.share({title:"BYTE Coin", text:txt, url}); }
  else { navigator.clipboard.writeText(txt); alert("Share text copied!"); }
  // reward small boost for sharing
  state.boostUntil = Date.now() + 5*60*1000; saveState(); renderAll();
});

/* ---------------------------
   Export data
   --------------------------- */
document.getElementById("exportBtn").addEventListener("click", ()=>{
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type: "application/json"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "byte_state.json"; document.body.appendChild(a); a.click(); a.remove();
});

/* ---------------------------
   Register local ledger entry for current user
   --------------------------- */
function registerLocalUser(){
  const key = APP_KEY + "_" + state.username;
  const rec = JSON.parse(localStorage.getItem(key)) || {username:state.username, balance:0, refBy: state.refBy, referrals: state.referrals || [], lastSeen:Date.now()};
  rec.balance = state.balance;
  rec.refBy = state.refBy;
  rec.referrals = rec.referrals || [];
  localStorage.setItem(key, JSON.stringify(rec));
  updateLeaderboard(rec);
}

/* ---------------------------
   Navigation
   --------------------------- */
function navTo(page){
  document.querySelectorAll("section").forEach(s=>s.style.display = "none");
  document.querySelectorAll(".menu button").forEach(b=>b.classList.remove("active"));
  if(page==="home"){ document.getElementById("home").style.display = "block"; document.getElementById("nav-home").classList.add("active"); }
  if(page==="ref"){ document.getElementById("ref").style.display = "block"; document.getElementById("nav-tap").classList.add("active"); }
  if(page==="profile"){ document.getElementById("profile").style.display = "block"; document.getElementById("nav-ref").classList.add("active"); }
  if(page==="white"){ document.getElementById("white").style.display = "block"; document.getElementById("nav-prof").classList.add("active"); }
  renderAll();
}

/* apply referral from input */
document.getElementById("applyBtn").addEventListener("click", ()=>{
  const code = document.getElementById("applyInput").value.trim();
  if(!code) return alert("Enter code");
  applyReferral(code);
});

/* coin tap */
document.getElementById("coin").addEventListener("click", ()=>{ tap(); });

/* connect wallet button */
document.getElementById("connectWallet").addEventListener("click", ()=>{ window.open("https://t.me/wallet","_blank"); });

/* init start */
init();
renderAll();
registerLocalUser();
navTo('home');
</script>
</body>
</html>
